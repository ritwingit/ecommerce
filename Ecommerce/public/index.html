<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>DarkStore | Home</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      :root {
        --bg: #050b18;
        --bg-elevated: #0b1020;
        --bg-card: #111827;
        --accent: #fbbf24;
        --accent-soft: rgba(251, 191, 36, 0.14);
        --accent-strong: #f59e0b;
        --text: #e5e7eb;
        --text-soft: #9ca3af;
        --border-subtle: #1f2937;
        --danger: #ef4444;
        --success: #22c55e;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(
          circle at top,
          #111827 0,
          #020617 45%,
          #000 100%
        );
        color: var(--text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      /* NAVBAR */

      .navbar {
        background: radial-gradient(circle at top, #020617 0, #000 60%);
        border-bottom: 1px solid var(--border-subtle);
        padding: 0.5rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1.5rem;
        position: sticky;
        top: 0;
        z-index: 20;
      }

      .nav-logo {
        display: flex;
        align-items: baseline;
        gap: 0.15rem;
        font-weight: 800;
        letter-spacing: 0.06em;
        text-transform: uppercase;
      }

      .nav-logo-main {
        font-size: 1.15rem;
      }

      .nav-logo-dot {
        font-size: 1.2rem;
        color: var(--accent);
      }

      .nav-logo-sub {
        font-size: 0.7rem;
        color: var(--text-soft);
      }

      .nav-search {
        flex: 1;
        display: flex;
        max-width: 680px;
      }

      .nav-search input {
        flex: 1;
        padding: 0.6rem 0.8rem;
        border-radius: 999px 0 0 999px;
        border: 1px solid var(--border-subtle);
        background: #020617;
        color: var(--text);
        outline: none;
        font-size: 0.9rem;
      }

      .nav-search input::placeholder {
        color: #4b5563;
      }

      .nav-search button {
        border-radius: 0 999px 999px 0;
        border: 1px solid var(--border-subtle);
        border-left: none;
        background: linear-gradient(
          135deg,
          var(--accent),
          var(--accent-strong)
        );
        padding: 0 1rem;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        color: #111827;
        display: flex;
        align-items: center;
        gap: 0.35rem;
      }

      .nav-actions {
        display: flex;
        align-items: center;
        gap: 1.25rem;
        font-size: 0.8rem;
      }

      .nav-actions-item {
        display: flex;
        flex-direction: column;
        line-height: 1.1;
        cursor: pointer;
      }

      .nav-actions-item span:first-child {
        color: var(--text-soft);
      }

      .nav-actions-item span:last-child {
        font-weight: 600;
      }

      .nav-cart {
        display: flex;
        align-items: center;
        gap: 0.35rem;
        cursor: pointer;
        padding: 0.45rem 0.8rem;
        border-radius: 999px;
        border: 1px solid var(--border-subtle);
        background: rgba(15, 23, 42, 0.8);
      }

      .nav-cart-count {
        background: var(--accent);
        color: #111827;
        font-size: 0.65rem;
        font-weight: 700;
        border-radius: 999px;
        padding: 0.1rem 0.35rem;
      }

      /* MAIN LAYOUT */

      .main {
        flex: 1;
        padding: 1.2rem 1.5rem 2.5rem;
      }

      .hero {
        border-radius: 1.25rem;
        padding: 1.25rem 1.5rem;
        background: radial-gradient(circle at top left, #1e293b 0, #020617 55%);
        border: 1px solid rgba(148, 163, 184, 0.16);
        display: flex;
        gap: 1.25rem;
        align-items: center;
        margin-bottom: 1.6rem;
        position: relative;
        overflow: hidden;
      }

      .hero::before {
        content: "";
        position: absolute;
        inset: -120px;
        background: radial-gradient(
            circle at 0 0,
            rgba(56, 189, 248, 0.12) 0,
            transparent 55%
          ),
          radial-gradient(
            circle at 100% 100%,
            rgba(251, 191, 36, 0.14) 0,
            transparent 55%
          );
        pointer-events: none;
        opacity: 0.9;
      }

      .hero-content {
        position: relative;
        z-index: 1;
        flex: 1;
      }

      .hero-pill {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        padding: 0.18rem 0.55rem;
        font-size: 0.7rem;
        color: var(--text-soft);
        margin-bottom: 0.5rem;
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(10px);
      }

      .hero-pill-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: var(--accent);
      }

      .hero-title {
        font-size: 1.5rem;
        font-weight: 800;
        letter-spacing: 0.02em;
        margin-bottom: 0.25rem;
      }

      .hero-highlight {
        background: linear-gradient(to right, #fde68a, #fca5a5, #a5b4fc);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .hero-subtitle {
        color: var(--text-soft);
        font-size: 0.85rem;
        max-width: 420px;
      }

      .hero-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.45rem;
        margin-top: 0.75rem;
        font-size: 0.7rem;
      }

      .hero-tag {
        padding: 0.2rem 0.55rem;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(75, 85, 99, 0.7);
      }

      .hero-promo {
        position: relative;
        z-index: 1;
        min-width: 210px;
        text-align: right;
      }

      .hero-badge {
        display: inline-flex;
        flex-direction: column;
        align-items: flex-end;
        padding: 0.55rem 0.8rem;
        border-radius: 0.85rem;
        background: rgba(15, 23, 42, 0.95);
        border: 1px solid rgba(148, 163, 184, 0.4);
        font-size: 0.75rem;
        gap: 0.2rem;
      }

      .hero-badge-main {
        font-size: 1.1rem;
        font-weight: 800;
        color: var(--accent);
      }

      .hero-badge-sub {
        color: var(--text-soft);
        font-size: 0.7rem;
      }

      .hero-badge-chip {
        font-size: 0.65rem;
        padding: 0.1rem 0.4rem;
        border-radius: 999px;
        background: rgba(22, 163, 74, 0.16);
        color: #bbf7d0;
        border: 1px solid rgba(34, 197, 94, 0.5);
      }

      /* SECTION HEADER */

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
        gap: 0.75rem;
      }

      .section-title {
        font-size: 0.95rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.35rem;
      }

      .section-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: var(--accent);
      }

      .section-subtitle {
        font-size: 0.75rem;
        color: var(--text-soft);
      }

      .section-controls {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.7rem;
      }

      .pill {
        padding: 0.3rem 0.6rem;
        border-radius: 999px;
        border: 1px solid var(--border-subtle);
        background: rgba(15, 23, 42, 0.85);
        cursor: pointer;
      }

      .pill.active {
        border-color: var(--accent);
        background: var(--accent-soft);
        color: var(--accent);
      }

      /* PRODUCTS GRID */

      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
        gap: 1rem;
      }

      .product-card {
        background: radial-gradient(
          circle at top,
          #020617 0,
          #020617 40%,
          #020617 100%
        );
        border-radius: 1rem;
        border: 1px solid rgba(31, 41, 55, 0.95);
        padding: 0.75rem;
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
        box-shadow: 0 18px 44px rgba(15, 23, 42, 0.75);
        position: relative;
        overflow: hidden;
      }

      .product-card::before {
        content: "";
        position: absolute;
        inset: -80px;
        background: radial-gradient(
          circle at 0 0,
          rgba(248, 250, 252, 0.09) 0,
          transparent 55%
        );
        opacity: 0.6;
        pointer-events: none;
      }

      .product-img-wrap {
        background: radial-gradient(
          circle at center,
          #020617 0,
          #020617 45%,
          #020617 100%
        );
        border-radius: 0.8rem;
        border: 1px solid rgba(31, 41, 55, 0.9);
        padding: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 150px;
        overflow: hidden;
      }

      .product-img {
        max-width: 100%;
        max-height: 140px;
        object-fit: contain;
        filter: drop-shadow(0 18px 28px rgba(0, 0, 0, 0.8));
      }

      .product-title {
        font-size: 0.8rem;
        font-weight: 600;
        margin-top: 0.15rem;
        min-height: 2.1em;
      }

      .product-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.75rem;
        color: var(--text-soft);
      }

      .product-price {
        font-size: 0.95rem;
        font-weight: 700;
        color: var(--accent);
      }

      .product-old-price {
        text-decoration: line-through;
        font-size: 0.65rem;
        color: #4b5563;
        margin-left: 0.2rem;
      }

      .product-badge {
        font-size: 0.65rem;
        padding: 0.1rem 0.45rem;
        border-radius: 999px;
        background: rgba(22, 163, 74, 0.18);
        color: #bbf7d0;
        border: 1px solid rgba(34, 197, 94, 0.5);
      }

      .stock-pill {
        font-size: 0.65rem;
        padding: 0.12rem 0.5rem;
        border-radius: 999px;
        border: 1px solid rgba(75, 85, 99, 0.9);
        color: var(--text-soft);
      }

      .stock-low {
        border-color: rgba(248, 113, 113, 0.9);
        color: #fecaca;
      }

      .product-actions {
        display: flex;
        gap: 0.4rem;
        margin-top: 0.35rem;
      }

      .btn {
        flex: 1;
        font-size: 0.75rem;
        padding: 0.45rem 0.5rem;
        border-radius: 999px;
        border: 1px solid var(--border-subtle);
        background: rgba(15, 23, 42, 0.85);
        color: var(--text-soft);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.25rem;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--accent),
          var(--accent-strong)
        );
        border-color: rgba(202, 138, 4, 0.9);
        color: #111827;
        font-weight: 600;
      }

      .badge-corner {
        position: absolute;
        top: 0.55rem;
        left: 0.6rem;
        font-size: 0.65rem;
        padding: 0.1rem 0.45rem;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.7);
        color: var(--text-soft);
      }

      .rating-line {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.7rem;
        color: var(--text-soft);
        margin-top: 0.1rem;
      }

      .stars {
        color: #facc15;
      }

      /* STATUS / LOADING */

      .status {
        font-size: 0.75rem;
        color: var(--text-soft);
        display: flex;
        align-items: center;
        gap: 0.35rem;
        margin-bottom: 0.6rem;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: var(--accent);
        box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.08);
      }

      .status-error {
        color: #fecaca;
      }

      /* AUTH MODAL */

      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(15, 23, 42, 0.85);
        backdrop-filter: blur(10px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 50;
      }

      .modal {
        width: 100%;
        max-width: 360px;
        background: #020617;
        border-radius: 1rem;
        border: 1px solid rgba(31, 41, 55, 0.95);
        box-shadow: 0 24px 60px rgba(15, 23, 42, 0.9);
        padding: 1rem;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.6rem;
      }

      .modal-title {
        font-size: 0.95rem;
        font-weight: 600;
      }

      .modal-close {
        border: none;
        background: none;
        color: var(--text-soft);
        cursor: pointer;
        font-size: 1rem;
      }

      .auth-tabs {
        display: flex;
        gap: 0.4rem;
        margin-bottom: 0.75rem;
      }

      .auth-tab {
        flex: 1;
        font-size: 0.75rem;
        padding: 0.4rem 0.5rem;
        border-radius: 999px;
        border: 1px solid var(--border-subtle);
        background: rgba(15, 23, 42, 0.9);
        color: var(--text-soft);
        cursor: pointer;
      }

      .auth-tab.active {
        border-color: var(--accent);
        background: var(--accent-soft);
        color: var(--accent);
      }

      .auth-form {
        display: flex;
        flex-direction: column;
        gap: 0.55rem;
      }

      .auth-field {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
      }

      .auth-label {
        font-size: 0.7rem;
        color: var(--text-soft);
      }

      .auth-input {
        padding: 0.45rem 0.55rem;
        border-radius: 0.6rem;
        border: 1px solid var(--border-subtle);
        background: #020617;
        color: var(--text);
        font-size: 0.8rem;
        outline: none;
      }

      .auth-btn {
        margin-top: 0.4rem;
        font-size: 0.8rem;
        padding: 0.5rem;
        border-radius: 999px;
        border: 1px solid rgba(202, 138, 4, 0.9);
        background: linear-gradient(
          135deg,
          var(--accent),
          var(--accent-strong)
        );
        color: #111827;
        font-weight: 600;
        cursor: pointer;
      }

      .auth-status {
        font-size: 0.7rem;
        color: var(--text-soft);
        min-height: 1.1em;
        margin-top: 0.3rem;
      }

      .auth-status.error {
        color: #fecaca;
      }

      .auth-status.success {
        color: #bbf7d0;
      }

      /* QUICK VIEW MODAL */

      .quick-modal {
        width: 100%;
        max-width: 480px;
        background: #020617;
        border-radius: 1rem;
        border: 1px solid rgba(31, 41, 55, 0.95);
        box-shadow: 0 24px 60px rgba(15, 23, 42, 0.9);
        padding: 1rem;
        display: flex;
        gap: 0.75rem;
      }

      .quick-modal-left {
        flex: 1;
      }

      .quick-modal-right {
        flex: 1.2;
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
      }

      .quick-modal-img-wrap {
        border-radius: 0.8rem;
        border: 1px solid rgba(31, 41, 55, 0.9);
        background: radial-gradient(
          circle at center,
          #020617 0,
          #020617 45%,
          #020617 100%
        );
        padding: 0.6rem;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 150px;
      }

      .quick-modal-img-wrap img {
        max-width: 100%;
        max-height: 170px;
        object-fit: contain;
      }

      .quick-title {
        font-size: 0.95rem;
        font-weight: 600;
      }

      .quick-desc {
        font-size: 0.75rem;
        color: var(--text-soft);
        max-height: 4.2em;
        overflow: hidden;
      }

      .quick-actions {
        display: flex;
        gap: 0.4rem;
        margin-top: 0.3rem;
      }

      /* FOOTER */

      .footer {
        border-top: 1px solid var(--border-subtle);
        padding: 0.75rem 1.5rem 1.25rem;
        font-size: 0.7rem;
        color: var(--text-soft);
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 0.5rem;
        background: radial-gradient(circle at bottom, #020617 0, #000 60%);
      }

      /* RESPONSIVE */

      @media (max-width: 900px) {
        .navbar {
          flex-wrap: wrap;
          row-gap: 0.6rem;
        }

        .nav-actions {
          display: none;
        }
      }

      @media (max-width: 700px) {
        .main {
          padding: 0.75rem 0.75rem 2rem;
        }

        .hero {
          flex-direction: column;
          align-items: flex-start;
        }

        .hero-promo {
          width: 100%;
          text-align: left;
        }
      }

      @media (max-width: 480px) {
        .nav-search input {
          font-size: 0.8rem;
        }

        .hero-title {
          font-size: 1.2rem;
        }

        .products-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body>
    <!-- NAVBAR -->
    <header class="navbar">
      <div class="nav-logo">
        <span class="nav-logo-main">Dark</span>
        <span class="nav-logo-main nav-logo-dot">.</span>
        <span class="nav-logo-main">Cart</span>
        <span class="nav-logo-sub">india</span>
      </div>

      <form class="nav-search" id="searchForm">
        <input
          id="searchInput"
          type="text"
          placeholder="Search for phones, laptops, accessories‚Ä¶"
        />
        <button type="submit">
          üîç
          <span>Search</span>
        </button>
      </form>

      <div class="nav-actions">
        <div class="nav-actions-item" id="accountBox">
          <span id="accountHello">Hello, Guest</span>
          <span id="accountAction">Sign in</span>
        </div>
        <div class="nav-actions-item">
          <span>Returns</span>
          <span>&amp; Orders</span>
        </div>
        <div class="nav-cart" id="navCart">
          üõí
          <span>Cart</span>
          <span class="nav-cart-count" id="cartCount">0</span>
        </div>
        <!-- Checkout quick link -->
        <div class="nav-actions-item" style="cursor: pointer" id="navCheckout">
          <span style="font-size: 11px; color: var(--text-soft)">Quick</span>
          <span style="font-weight: 700">Checkout</span>
        </div>
      </div>
    </header>

    <!-- MAIN -->
    <main class="main">
      <!-- HERO -->
      <section class="hero">
        <div class="hero-content">
          <div class="hero-pill">
            <span class="hero-pill-dot"></span>
            Today‚Äôs lightning picks curated for you
          </div>
          <h1 class="hero-title">
            Shop in <span class="hero-highlight">dark mode luxury</span> with
            full backend power.
          </h1>
          <p class="hero-subtitle">
            Browse products from your Node + MongoDB backend with a sleek
            Amazon-style dark interface. Fully dynamic, fully yours.
          </p>
          <div class="hero-tags">
            <span class="hero-tag">Live from /api/products</span>
            <span class="hero-tag">JWT-ready backend</span>
            <span class="hero-tag">Responsive layout</span>
            <span class="hero-tag">Built for India üáÆüá≥</span>
          </div>
        </div>
        <div class="hero-promo">
          <div class="hero-badge">
            <span class="hero-badge-main">Up to 60% OFF</span>
            <span class="hero-badge-sub">On curated tech &amp; gadgets</span>
            <span class="hero-badge-chip">Realtime data from MongoDB</span>
          </div>
        </div>
      </section>

      <!-- SECTION HEADER -->
      <div class="section-header">
        <div>
          <div class="section-title">
            <span class="section-dot"></span>
            <span>Today‚Äôs featured products</span>
          </div>
          <div class="section-subtitle">
            Data streaming directly from your Express API.
          </div>
        </div>
        <div class="section-controls">
          <button class="pill active" type="button">All</button>
          <button class="pill" type="button" disabled>Electronics</button>
          <button class="pill" type="button" disabled>Fashion</button>
        </div>
      </div>

      <!-- STATUS -->
      <div id="status" class="status">
        <span class="status-dot"></span>
        <span id="statusText">Loading products from backend‚Ä¶</span>
      </div>

      <!-- PRODUCTS GRID -->
      <section class="products-grid" id="productsGrid"></section>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
      <span>DarkCart ‚Ä¢ Powered by your Node + Express + MongoDB stack</span>
      <span>Made for learning APIs, auth, carts and orders.</span>
    </footer>

    <!-- AUTH MODAL -->
    <div class="modal-backdrop" id="authModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">Welcome to DarkCart</div>
          <button class="modal-close" id="modalCloseBtn">‚úï</button>
        </div>

        <div class="auth-tabs">
          <button class="auth-tab active" id="tabLogin">Login</button>
          <button class="auth-tab" id="tabRegister">Register</button>
        </div>

        <form class="auth-form" id="authForm">
          <div class="auth-field" id="nameField" style="display: none">
            <label class="auth-label" for="authName">Name</label>
            <input class="auth-input" type="text" id="authName" />
          </div>
          <div class="auth-field">
            <label class="auth-label" for="authEmail">Email</label>
            <input class="auth-input" type="email" id="authEmail" required />
          </div>
          <div class="auth-field">
            <label class="auth-label" for="authPassword">Password</label>
            <input
              class="auth-input"
              type="password"
              id="authPassword"
              required
            />
          </div>
          <button class="auth-btn" type="submit" id="authSubmitBtn">
            Login
          </button>
          <div class="auth-status" id="authStatus"></div>
        </form>
      </div>
    </div>

    <!-- QUICK VIEW MODAL -->
    <div class="modal-backdrop" id="quickViewModal">
      <div class="quick-modal">
        <div class="quick-modal-left">
          <div class="quick-modal-img-wrap" id="quickImgWrap">
            <span style="font-size: 2.2rem; opacity: 0.5">üì¶</span>
          </div>
        </div>
        <div class="quick-modal-right">
          <div class="modal-header" style="padding: 0; margin-bottom: 0.3rem">
            <div class="modal-title" id="quickTitle" style="font-size: 0.9rem">
              Product
            </div>
            <button class="modal-close" id="quickCloseBtn">‚úï</button>
          </div>
          <div class="rating-line">
            <span class="stars" id="quickStars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
            <span id="quickRatingText">(0)</span>
            <span id="quickReviewsText">0 reviews</span>
          </div>
          <div class="product-price" id="quickPrice" style="margin-top: 0.2rem">
            ‚Çπ0
          </div>
          <div class="stock-pill" id="quickStock" style="margin-top: 0.2rem">
            In stock
          </div>
          <p class="quick-desc" id="quickDesc">
            Description will appear here for quick preview.
          </p>
          <div class="quick-actions">
            <button class="btn btn-primary" id="quickAddBtn">
              üõí Add to Cart
            </button>
            <button class="btn" id="quickDetailsBtn">View full details</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // ====== BASIC STATE & HELPERS ======
      const productsGrid = document.getElementById("productsGrid");
      const statusText = document.getElementById("statusText");
      const statusEl = document.getElementById("status");
      const cartCountEl = document.getElementById("cartCount");

      const searchForm = document.getElementById("searchForm");
      const searchInput = document.getElementById("searchInput");

      const accountBox = document.getElementById("accountBox");
      const accountHello = document.getElementById("accountHello");
      const accountAction = document.getElementById("accountAction");
      const navCart = document.getElementById("navCart");
      const navCheckout = document.getElementById("navCheckout");

      // auth modal elements
      const authModal = document.getElementById("authModal");
      const modalCloseBtn = document.getElementById("modalCloseBtn");
      const tabLogin = document.getElementById("tabLogin");
      const tabRegister = document.getElementById("tabRegister");
      const nameField = document.getElementById("nameField");
      const authForm = document.getElementById("authForm");
      const authName = document.getElementById("authName");
      const authEmail = document.getElementById("authEmail");
      const authPassword = document.getElementById("authPassword");
      const authSubmitBtn = document.getElementById("authSubmitBtn");
      const authStatus = document.getElementById("authStatus");

      // quick view elements
      const quickViewModal = document.getElementById("quickViewModal");
      const quickCloseBtn = document.getElementById("quickCloseBtn");
      const quickImgWrap = document.getElementById("quickImgWrap");
      const quickTitle = document.getElementById("quickTitle");
      const quickStars = document.getElementById("quickStars");
      const quickRatingText = document.getElementById("quickRatingText");
      const quickReviewsText = document.getElementById("quickReviewsText");
      const quickPrice = document.getElementById("quickPrice");
      const quickStock = document.getElementById("quickStock");
      const quickDesc = document.getElementById("quickDesc");
      const quickAddBtn = document.getElementById("quickAddBtn");
      const quickDetailsBtn = document.getElementById("quickDetailsBtn");

      let isLoginMode = true;
      let quickProduct = null;

      function getToken() {
        return localStorage.getItem("token") || null;
      }

      function getUserName() {
        return localStorage.getItem("userName") || null;
      }

      function setAuth(token, user) {
        if (token) localStorage.setItem("token", token);
        if (user?.name) localStorage.setItem("userName", user.name);
        updateAuthUI();
        loadCartCount();
      }

      function clearAuth() {
        localStorage.removeItem("token");
        localStorage.removeItem("userName");
        updateAuthUI();
        cartCountEl.textContent = "0";
      }

      function authHeaders() {
        const headers = { "Content-Type": "application/json" };
        const token = getToken();
        if (token) headers["Authorization"] = "Bearer " + token;
        return headers;
      }

      function updateAuthUI() {
        const name = getUserName();
        const token = getToken();

        if (token && name) {
          accountHello.textContent = `Hello, ${name}`;
          accountAction.textContent = "Sign out";
        } else if (token) {
          accountHello.textContent = "Hello, User";
          accountAction.textContent = "Sign out";
        } else {
          accountHello.textContent = "Hello, Guest";
          accountAction.textContent = "Sign in";
        }
      }

      function formatPrice(num) {
        if (typeof num !== "number") return "‚Äî";
        return "‚Çπ" + num.toLocaleString("en-IN");
      }

      function fakeDiscount(price) {
        if (typeof price !== "number") return null;
        const bump = Math.round(price * 1.18);
        return bump;
      }

      function renderStars(rating) {
        const full = Math.round(rating || 0);
        let stars = "";
        for (let i = 1; i <= 5; i++) {
          stars += i <= full ? "‚òÖ" : "‚òÜ";
        }
        return stars;
      }

      // ====== AUTH MODAL LOGIC ======

      function openAuthModal(mode = "login") {
        isLoginMode = mode === "login";
        authModal.style.display = "flex";
        authStatus.textContent = "";
        authStatus.className = "auth-status";

        if (isLoginMode) {
          tabLogin.classList.add("active");
          tabRegister.classList.remove("active");
          nameField.style.display = "none";
          authSubmitBtn.textContent = "Login";
        } else {
          tabLogin.classList.remove("active");
          tabRegister.classList.add("active");
          nameField.style.display = "flex";
          authSubmitBtn.textContent = "Register";
        }
      }

      function closeAuthModal() {
        authModal.style.display = "none";
      }

      tabLogin.addEventListener("click", () => openAuthModal("login"));
      tabRegister.addEventListener("click", () => openAuthModal("register"));
      modalCloseBtn.addEventListener("click", closeAuthModal);

      accountBox.addEventListener("click", () => {
        const token = getToken();
        if (token) {
          if (confirm("Sign out from DarkCart?")) {
            clearAuth();
          }
        } else {
          openAuthModal("login");
        }
      });

      authForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        authStatus.textContent = "";
        authStatus.className = "auth-status";

        const email = authEmail.value.trim();
        const password = authPassword.value.trim();
        const name = authName.value.trim();

        if (!email || !password || (!isLoginMode && !name)) {
          authStatus.textContent = "Please fill all fields.";
          authStatus.classList.add("error");
          return;
        }

        try {
          authSubmitBtn.textContent = isLoginMode
            ? "Logging in‚Ä¶"
            : "Registering‚Ä¶";
          authSubmitBtn.disabled = true;

          const endpoint = isLoginMode
            ? "/api/auth/login"
            : "/api/auth/register";

          const res = await fetch(endpoint, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(
              isLoginMode ? { email, password } : { name, email, password }
            ),
          });

          const data = await res.json();

          if (!res.ok) {
            authStatus.textContent =
              data.message || "Auth failed. Check details.";
            authStatus.classList.add("error");
          } else {
            authStatus.textContent = isLoginMode
              ? "Logged in successfully."
              : "Registered & logged in.";
            authStatus.classList.add("success");

            setAuth(data.token, data.user);
            setTimeout(closeAuthModal, 700);
          }
        } catch (err) {
          console.error(err);
          authStatus.textContent = "Something went wrong. Try again.";
          authStatus.classList.add("error");
        } finally {
          authSubmitBtn.disabled = false;
          authSubmitBtn.textContent = isLoginMode ? "Login" : "Register";
        }
      });

      // ====== NAV CART & CHECKOUT CLICK ======

      navCart.addEventListener("click", () => {
        window.location.href = "/cart.html";
      });

      navCheckout.addEventListener("click", () => {
        const token = getToken();
        if (!token) {
          openAuthModal("login");
          return;
        }
        window.location.href = "/order.html";
      });

      // ====== QUICK VIEW MODAL ======

      function openQuickView(product) {
        quickProduct = product || null;
        if (!quickProduct) return;

        // image
        if (quickProduct.image) {
          quickImgWrap.innerHTML = `<img src="${quickProduct.image}" alt="${quickProduct.title}" />`;
        } else {
          quickImgWrap.innerHTML = `<span style="font-size:2.2rem;opacity:0.5;">üì¶</span>`;
        }

        quickTitle.textContent = quickProduct.title || "Untitled product";

        const rating = quickProduct.rating || 0;
        const numReviews = quickProduct.numReviews || 0;

        quickStars.textContent = renderStars(rating);
        quickRatingText.textContent = rating
          ? `${rating.toFixed(1)} / 5`
          : "No rating yet";
        quickReviewsText.textContent =
          numReviews + (numReviews === 1 ? " review" : " reviews");

        quickPrice.textContent = formatPrice(quickProduct.price);
        const inStock =
          typeof quickProduct.countInStock === "number"
            ? quickProduct.countInStock > 0
            : true;

        quickStock.textContent = inStock
          ? typeof quickProduct.countInStock === "number"
            ? quickProduct.countInStock + " left in stock"
            : "In stock"
          : "Currently unavailable";

        quickStock.style.borderColor = inStock
          ? "rgba(34,197,94,0.9)"
          : "rgba(248,113,113,0.9)";
        quickStock.style.color = inStock ? "#bbf7d0" : "#fecaca";

        quickDesc.textContent =
          quickProduct.description || "No description available.";

        quickViewModal.style.display = "flex";
      }

      function closeQuickView() {
        quickViewModal.style.display = "none";
        quickProduct = null;
      }

      quickCloseBtn.addEventListener("click", closeQuickView);
      quickViewModal.addEventListener("click", (e) => {
        if (e.target === quickViewModal) {
          closeQuickView();
        }
      });

      quickAddBtn.addEventListener("click", async () => {
        const token = getToken();
        if (!token) {
          openAuthModal("login");
          return;
        }
        if (!quickProduct?._id) return;

        try {
          quickAddBtn.textContent = "Adding‚Ä¶";
          const res = await fetch("/api/cart/add", {
            method: "POST",
            headers: authHeaders(),
            body: JSON.stringify({
              productId: quickProduct._id,
              quantity: 1,
            }),
          });
          const data = await res.json();
          if (!res.ok) {
            quickAddBtn.textContent = "Error";
            setTimeout(
              () => (quickAddBtn.textContent = "üõí Add to Cart"),
              1200
            );
            return;
          }
          const totalItems = data.cart.items.reduce(
            (sum, item) => sum + (item.quantity || 0),
            0
          );
          cartCountEl.textContent = totalItems;
          quickAddBtn.textContent = "‚úì Added";
          setTimeout(() => (quickAddBtn.textContent = "üõí Add to Cart"), 1200);
        } catch (err) {
          console.error(err);
          quickAddBtn.textContent = "Error";
          setTimeout(() => (quickAddBtn.textContent = "üõí Add to Cart"), 1200);
        }
      });

      quickDetailsBtn.addEventListener("click", () => {
        if (!quickProduct?._id) return;
        window.location.href = `/product.html?id=${quickProduct._id}`;
      });

      // ====== PRODUCTS & CART ======

      function createProductCard(p) {
        const card = document.createElement("article");
        card.className = "product-card";

        const oldPrice = fakeDiscount(p.price);

        const lowStock =
          typeof p.countInStock === "number" &&
          p.countInStock > 0 &&
          p.countInStock <= 5;
        const outOfStock =
          typeof p.countInStock === "number" && p.countInStock === 0;

        const rating = p.rating || 0;
        const numReviews = p.numReviews || 0;

        card.innerHTML = `
          <div class="badge-corner">${p.category || "Featured"}</div>
          <div class="product-img-wrap">
            ${
              p.image
                ? `<img src="${p.image}" alt="${p.title}" class="product-img" />`
                : `<span style="font-size:2.2rem; opacity:0.5;">üì¶</span>`
            }
          </div>
          <h2 class="product-title">${p.title || "Untitled product"}</h2>
          <div class="rating-line">
            <span class="stars">${renderStars(rating)}</span>
            <span>${rating ? rating.toFixed(1) : "No rating"}</span>
            <span>‚Ä¢ ${numReviews} review${numReviews === 1 ? "" : "s"}</span>
          </div>
          <div class="product-meta">
            <div>
              <span class="product-price">${formatPrice(p.price)}</span>
              ${
                oldPrice
                  ? `<span class="product-old-price">${formatPrice(
                      oldPrice
                    )}</span>`
                  : ""
              }
            </div>
            <span class="product-badge">${
              outOfStock ? "Out of stock" : "Prime eligible"
            }</span>
          </div>
          <div class="product-meta" style="margin-top:0.2rem;">
            <span class="stock-pill ${lowStock ? "stock-low" : ""}">
              ${
                outOfStock
                  ? "Currently unavailable"
                  : typeof p.countInStock === "number"
                  ? p.countInStock + " left in stock"
                  : "In stock"
              }
            </span>
          </div>
          <div class="product-actions">
            <button class="btn details-btn" type="button">Details</button>
            <button class="btn btn-primary add-btn" type="button">üõí Add to Cart</button>
          </div>
        `;

        const addBtn = card.querySelector(".add-btn");
        const detailsBtn = card.querySelector(".details-btn");

        // Click ‚Üí full product page
        detailsBtn.addEventListener("click", () => {
          if (!p._id) return;
          window.location.href = `/product.html?id=${p._id}`;
        });

        addBtn.addEventListener("click", async () => {
          const token = getToken();
          if (!token) {
            openAuthModal("login");
            return;
          }

          if (!p._id) {
            console.error("Product has no _id, cannot add to cart");
            return;
          }

          try {
            addBtn.textContent = "Adding‚Ä¶";

            const res = await fetch("/api/cart/add", {
              method: "POST",
              headers: authHeaders(),
              body: JSON.stringify({
                productId: p._id,
                quantity: 1,
              }),
            });

            const data = await res.json();

            if (!res.ok) {
              console.error(data);
              addBtn.textContent = "Error";
              setTimeout(() => {
                addBtn.textContent = "üõí Add to Cart";
              }, 1200);
              return;
            }

            const totalItems = data.cart.items.reduce(
              (sum, item) => sum + (item.quantity || 0),
              0
            );

            cartCountEl.textContent = totalItems;
            addBtn.textContent = "‚úì Added";
            setTimeout(() => {
              addBtn.textContent = "üõí Add to Cart";
            }, 1200);
          } catch (err) {
            console.error(err);
            addBtn.textContent = "Error";
            setTimeout(() => {
              addBtn.textContent = "üõí Add to Cart";
            }, 1200);
          }
        });

        return card;
      }

      async function loadProducts(searchTerm = "") {
        try {
          statusEl.style.display = "flex";
          statusText.textContent = "Loading products from backend‚Ä¶";

          productsGrid.innerHTML = "";

          const url =
            searchTerm && searchTerm.trim().length > 0
              ? `/api/products?q=${encodeURIComponent(searchTerm.trim())}`
              : "/api/products";

          const res = await fetch(url);

          if (!res.ok) {
            throw new Error("API returned " + res.status);
          }

          const data = await res.json();

          if (!Array.isArray(data) || data.length === 0) {
            statusText.textContent =
              "No products found. Try adding products via your admin API.";
            productsGrid.innerHTML = "";
            return;
          }

          statusText.textContent = `Showing ${data.length} product${
            data.length > 1 ? "s" : ""
          } from your backend.`;

          data.forEach((p) => {
            const card = createProductCard(p);
            productsGrid.appendChild(card);
          });
        } catch (err) {
          console.error(err);
          statusText.textContent =
            "Failed to load products. Check that your server and /api/products route are running.";
          statusText.classList.add("status-error");
        }
      }

      async function loadCartCount() {
        const token = getToken();
        if (!token) {
          cartCountEl.textContent = "0";
          return;
        }

        try {
          const res = await fetch("/api/cart", {
            method: "GET",
            headers: authHeaders(),
          });
          if (!res.ok) {
            cartCountEl.textContent = "0";
            return;
          }
          const cart = await res.json();
          const items = cart.items || [];
          const total = items.reduce(
            (sum, item) => sum + (item.quantity || 0),
            0
          );
          cartCountEl.textContent = total;
        } catch (err) {
          console.error(err);
          cartCountEl.textContent = "0";
        }
      }

      // Search form
      searchForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const term = searchInput.value;
        loadProducts(term);
      });

      // ====== INITIAL LOAD ======
      updateAuthUI();
      loadProducts();
      loadCartCount();
    </script>
  </body>
</html>
